<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>deskflow: Flash Tutorial - Custom Client</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">deskflow<span id="projectnumber">&#160;1.22.0.9999</span>
   </div>
   <div id="projectbrief">Keyboard and mouse sharing utility</div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md_doc_2dev_2flash__tutorial.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Flash Tutorial - Custom Client</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md8"></a></p>
<p>(code was compiled on a windows machine, though not tested agains a server.)</p>
<h1><a class="anchor" id="autotoc_md9"></a>
Scenario</h1>
<p>Imagine a setup with three computers. The first is your primary desktop, running the Deskflow server. The second is another computer (e.g., a laptop) running the standard Deskflow client. The third computer runs a custom operating system, and our goal is to build a new, minimal client from scratch for this custom OS, allowing it to be controlled seamlessly by the primary desktop.</p>
<p>This tutorial guides you through the process of creating this minimal client.</p>
<h1><a class="anchor" id="autotoc_md10"></a>
Step 0: Project Structure Setup</h1>
<p>Create the project directory and files:</p>
<div class="fragment"><div class="line">mkdir myclient</div>
<div class="line">cd myclient</div>
</div><!-- fragment --><p>We will create the following files:</p><ul>
<li><code>main.cpp</code> - Main application entry point</li>
<li><code>client.h</code> - <a class="el" href="classClient.html" title="Deskflow client.">Client</a> class declaration</li>
<li><code>client.cpp</code> - <a class="el" href="classClient.html" title="Deskflow client.">Client</a> implementation</li>
<li><code>CMakeLists.txt</code> - Build configuration</li>
</ul>
<h1><a class="anchor" id="autotoc_md11"></a>
Step 1: Project Setup and Dependencies</h1>
<p>Create a basic C++ project with socket support. You'll need:</p>
<div class="fragment"><div class="line"># CMakeLists.txt</div>
<div class="line">cmake_minimum_required(VERSION 3.10)</div>
<div class="line">project(DeskflowClient)</div>
<div class="line"> </div>
<div class="line">set(CMAKE_CXX_STANDARD 17)</div>
<div class="line"> </div>
<div class="line">add_executable(deskflow_client main.cpp client.cpp)</div>
<div class="line"> </div>
<div class="line"># Platform-specific socket libraries</div>
<div class="line">if(WIN32)</div>
<div class="line">    target_link_libraries(deskflow_client ws2_32)</div>
<div class="line">else()</div>
<div class="line">    # Unix/Linux - no additional libraries needed</div>
<div class="line">endif()</div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="comment">// main.cpp</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cstring&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;arpa/inet.h&gt;</span>  <span class="comment">// For network byte order conversion</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/socket.h&gt;</span> <span class="comment">// For socket operations</span></div>
<div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span>     <span class="comment">// For close()</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Protocol constants from ProtocolTypes.h</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code hl_variable" href="ProtocolTypes_8cpp.html#a7fe883657ad6c4ac7077705202493ff6">kMsgHello</a> = <span class="stringliteral">&quot;Deskflow&quot;</span>;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code hl_variable" href="ProtocolTypes_8cpp.html#afc643c9a9e9f9daf5082657a4faf6575">kMsgHelloBack</a> = <span class="stringliteral">&quot;Deskflow&quot;</span>;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code hl_variable" href="ProtocolTypes_8cpp.html#ae826571a53b798c573418568f4397190">kMsgCEnter</a> = <span class="stringliteral">&quot;CINN&quot;</span>;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code hl_variable" href="ProtocolTypes_8cpp.html#a35d0d7f0915dec1e257361c62375c368">kMsgCLeave</a> = <span class="stringliteral">&quot;COUT&quot;</span>;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code hl_variable" href="ProtocolTypes_8cpp.html#a3347d0669e9605acefc17c4f1ee07a7d">kMsgDKeyDown</a> = <span class="stringliteral">&quot;DKDN&quot;</span>;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code hl_variable" href="ProtocolTypes_8cpp.html#a913e15118bd280fffb9c8c32b09c66cc">kMsgDKeyUp</a> = <span class="stringliteral">&quot;DKUP&quot;</span>;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code hl_variable" href="ProtocolTypes_8cpp.html#abdaf456469bf555b61c284c1587f35cd">kMsgDMouseMove</a> = <span class="stringliteral">&quot;DMMV&quot;</span>;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code hl_variable" href="ProtocolTypes_8cpp.html#aff32db0e9923aae3eba184bde7aecb87">kMsgDMouseDown</a> = <span class="stringliteral">&quot;DMDN&quot;</span>;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code hl_variable" href="ProtocolTypes_8cpp.html#aae6fdcf9a64d2cb4adce0d5e5e7b63cb">kMsgDMouseUp</a> = <span class="stringliteral">&quot;DMUP&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>DeskflowClient {</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <span class="keywordtype">int</span> socket_fd;</div>
<div class="line">    std::string server_ip;</div>
<div class="line">    <span class="keywordtype">int</span> server_port;</div>
<div class="line">    </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    DeskflowClient(<span class="keyword">const</span> std::string&amp; ip, <span class="keywordtype">int</span> port) </div>
<div class="line">        : server_ip(ip), server_port(port), socket_fd(-1) {}</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">bool</span> connect();</div>
<div class="line">    <span class="keywordtype">bool</span> performHandshake();</div>
<div class="line">    <span class="keywordtype">void</span> messageLoop();</div>
<div class="line">    <span class="keywordtype">void</span> disconnect();</div>
<div class="line">};</div>
<div class="ttc" id="aProtocolTypes_8cpp_html_a3347d0669e9605acefc17c4f1ee07a7d"><div class="ttname"><a href="ProtocolTypes_8cpp.html#a3347d0669e9605acefc17c4f1ee07a7d">kMsgDKeyDown</a></div><div class="ttdeci">const char *const kMsgDKeyDown</div><div class="ttdef"><b>Definition</b> ProtocolTypes.cpp:29</div></div>
<div class="ttc" id="aProtocolTypes_8cpp_html_a35d0d7f0915dec1e257361c62375c368"><div class="ttname"><a href="ProtocolTypes_8cpp.html#a35d0d7f0915dec1e257361c62375c368">kMsgCLeave</a></div><div class="ttdeci">const char *const kMsgCLeave</div><div class="ttdef"><b>Definition</b> ProtocolTypes.cpp:22</div></div>
<div class="ttc" id="aProtocolTypes_8cpp_html_a7fe883657ad6c4ac7077705202493ff6"><div class="ttname"><a href="ProtocolTypes_8cpp.html#a7fe883657ad6c4ac7077705202493ff6">kMsgHello</a></div><div class="ttdeci">const char *const kMsgHello</div><div class="ttdef"><b>Definition</b> ProtocolTypes.cpp:15</div></div>
<div class="ttc" id="aProtocolTypes_8cpp_html_a913e15118bd280fffb9c8c32b09c66cc"><div class="ttname"><a href="ProtocolTypes_8cpp.html#a913e15118bd280fffb9c8c32b09c66cc">kMsgDKeyUp</a></div><div class="ttdeci">const char *const kMsgDKeyUp</div><div class="ttdef"><b>Definition</b> ProtocolTypes.cpp:33</div></div>
<div class="ttc" id="aProtocolTypes_8cpp_html_aae6fdcf9a64d2cb4adce0d5e5e7b63cb"><div class="ttname"><a href="ProtocolTypes_8cpp.html#aae6fdcf9a64d2cb4adce0d5e5e7b63cb">kMsgDMouseUp</a></div><div class="ttdeci">const char *const kMsgDMouseUp</div><div class="ttdef"><b>Definition</b> ProtocolTypes.cpp:36</div></div>
<div class="ttc" id="aProtocolTypes_8cpp_html_abdaf456469bf555b61c284c1587f35cd"><div class="ttname"><a href="ProtocolTypes_8cpp.html#abdaf456469bf555b61c284c1587f35cd">kMsgDMouseMove</a></div><div class="ttdeci">const char *const kMsgDMouseMove</div><div class="ttdef"><b>Definition</b> ProtocolTypes.cpp:37</div></div>
<div class="ttc" id="aProtocolTypes_8cpp_html_ae826571a53b798c573418568f4397190"><div class="ttname"><a href="ProtocolTypes_8cpp.html#ae826571a53b798c573418568f4397190">kMsgCEnter</a></div><div class="ttdeci">const char *const kMsgCEnter</div><div class="ttdef"><b>Definition</b> ProtocolTypes.cpp:21</div></div>
<div class="ttc" id="aProtocolTypes_8cpp_html_afc643c9a9e9f9daf5082657a4faf6575"><div class="ttname"><a href="ProtocolTypes_8cpp.html#afc643c9a9e9f9daf5082657a4faf6575">kMsgHelloBack</a></div><div class="ttdeci">const char *const kMsgHelloBack</div><div class="ttdef"><b>Definition</b> ProtocolTypes.cpp:17</div></div>
<div class="ttc" id="aProtocolTypes_8cpp_html_aff32db0e9923aae3eba184bde7aecb87"><div class="ttname"><a href="ProtocolTypes_8cpp.html#aff32db0e9923aae3eba184bde7aecb87">kMsgDMouseDown</a></div><div class="ttdeci">const char *const kMsgDMouseDown</div><div class="ttdef"><b>Definition</b> ProtocolTypes.cpp:35</div></div>
</div><!-- fragment --><p>*Reference: protocol_overview for protocol architecture*</p>
<h1><a class="anchor" id="autotoc_md12"></a>
Step 2: Network Connection</h1>
<p>Establish TCP connection to the Deskflow server:</p>
<div class="fragment"><div class="line"><span class="comment">// client.h</span></div>
<div class="line"><span class="preprocessor">#pragma once</span></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef _WIN32</span></div>
<div class="line"><span class="preprocessor">    #include &lt;winsock2.h&gt;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>DeskflowClient {</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line"><span class="preprocessor">#ifdef _WIN32</span></div>
<div class="line">    SOCKET socket_fd;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">    <span class="keywordtype">int</span> socket_fd;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">    std::string server_ip;</div>
<div class="line">    <span class="keywordtype">int</span> server_port;</div>
<div class="line">    </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    DeskflowClient(<span class="keyword">const</span> std::string&amp; ip, <span class="keywordtype">int</span> port);</div>
<div class="line">    ~DeskflowClient();</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">bool</span> connect();</div>
<div class="line">    <span class="keywordtype">void</span> disconnect();</div>
<div class="line">    <span class="keywordtype">bool</span> performHandshake();</div>
<div class="line">    <span class="keywordtype">void</span> messageLoop();</div>
<div class="line">    </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <span class="keywordtype">bool</span> sendMessage(<span class="keyword">const</span> std::string&amp; message);</div>
<div class="line">    std::string receiveMessage();</div>
<div class="line">    <span class="keywordtype">void</span> handleEnterMessage(<span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code hl_variable" href="ArchNetworkWinsock_8cpp.html#aa36d05423b2dd8f3c8296093b4674b63">data</a>, <span class="keywordtype">size_t</span> length);</div>
<div class="line">    <span class="keywordtype">void</span> handleLeaveMessage();</div>
<div class="line">    <span class="keywordtype">void</span> handleKeyDownMessage(<span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code hl_variable" href="ArchNetworkWinsock_8cpp.html#aa36d05423b2dd8f3c8296093b4674b63">data</a>, <span class="keywordtype">size_t</span> length);</div>
<div class="line">    <span class="keywordtype">void</span> handleKeyUpMessage(<span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code hl_variable" href="ArchNetworkWinsock_8cpp.html#aa36d05423b2dd8f3c8296093b4674b63">data</a>, <span class="keywordtype">size_t</span> length);</div>
<div class="line">    <span class="keywordtype">void</span> handleMouseMoveMessage(<span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code hl_variable" href="ArchNetworkWinsock_8cpp.html#aa36d05423b2dd8f3c8296093b4674b63">data</a>, <span class="keywordtype">size_t</span> length);</div>
<div class="line">    <span class="keywordtype">void</span> handleMouseDownMessage(<span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code hl_variable" href="ArchNetworkWinsock_8cpp.html#aa36d05423b2dd8f3c8296093b4674b63">data</a>, <span class="keywordtype">size_t</span> length);</div>
<div class="line">    <span class="keywordtype">void</span> handleMouseUpMessage(<span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code hl_variable" href="ArchNetworkWinsock_8cpp.html#aa36d05423b2dd8f3c8296093b4674b63">data</a>, <span class="keywordtype">size_t</span> length);</div>
<div class="line">};</div>
<div class="ttc" id="aArchNetworkWinsock_8cpp_html_aa36d05423b2dd8f3c8296093b4674b63"><div class="ttname"><a href="ArchNetworkWinsock_8cpp.html#aa36d05423b2dd8f3c8296093b4674b63">data</a></div><div class="ttdeci">static int void FAR * data</div><div class="ttdef"><b>Definition</b> ArchNetworkWinsock.cpp:34</div></div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="comment">// client.cpp</span></div>
<div class="line"><span class="preprocessor">#include &quot;client.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cstring&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef _WIN32</span></div>
<div class="line"><span class="preprocessor">    #include &lt;winsock2.h&gt;</span></div>
<div class="line"><span class="preprocessor">    #include &lt;ws2tcpip.h&gt;</span></div>
<div class="line"><span class="preprocessor">    #pragma comment(lib, &quot;ws2_32.lib&quot;)</span></div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor">    #include &lt;sys/socket.h&gt;</span></div>
<div class="line"><span class="preprocessor">    #include &lt;netinet/in.h&gt;</span></div>
<div class="line"><span class="preprocessor">    #include &lt;arpa/inet.h&gt;</span></div>
<div class="line"><span class="preprocessor">    #include &lt;unistd.h&gt;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Protocol constants from ProtocolTypes.h</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code hl_variable" href="ProtocolTypes_8cpp.html#a7fe883657ad6c4ac7077705202493ff6">kMsgHello</a> = <span class="stringliteral">&quot;Deskflow&quot;</span>;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code hl_variable" href="ProtocolTypes_8cpp.html#afc643c9a9e9f9daf5082657a4faf6575">kMsgHelloBack</a> = <span class="stringliteral">&quot;Deskflow&quot;</span>;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code hl_variable" href="ProtocolTypes_8cpp.html#ae826571a53b798c573418568f4397190">kMsgCEnter</a> = <span class="stringliteral">&quot;CINN&quot;</span>;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code hl_variable" href="ProtocolTypes_8cpp.html#a35d0d7f0915dec1e257361c62375c368">kMsgCLeave</a> = <span class="stringliteral">&quot;COUT&quot;</span>;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code hl_variable" href="ProtocolTypes_8cpp.html#a3347d0669e9605acefc17c4f1ee07a7d">kMsgDKeyDown</a> = <span class="stringliteral">&quot;DKDN&quot;</span>;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code hl_variable" href="ProtocolTypes_8cpp.html#a913e15118bd280fffb9c8c32b09c66cc">kMsgDKeyUp</a> = <span class="stringliteral">&quot;DKUP&quot;</span>;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code hl_variable" href="ProtocolTypes_8cpp.html#abdaf456469bf555b61c284c1587f35cd">kMsgDMouseMove</a> = <span class="stringliteral">&quot;DMMV&quot;</span>;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code hl_variable" href="ProtocolTypes_8cpp.html#aff32db0e9923aae3eba184bde7aecb87">kMsgDMouseDown</a> = <span class="stringliteral">&quot;DMDN&quot;</span>;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code hl_variable" href="ProtocolTypes_8cpp.html#aae6fdcf9a64d2cb4adce0d5e5e7b63cb">kMsgDMouseUp</a> = <span class="stringliteral">&quot;DMUP&quot;</span>;</div>
<div class="line"> </div>
<div class="line">DeskflowClient::DeskflowClient(<span class="keyword">const</span> std::string&amp; ip, <span class="keywordtype">int</span> port) </div>
<div class="line">    : server_ip(ip), server_port(port) {</div>
<div class="line"><span class="preprocessor">#ifdef _WIN32</span></div>
<div class="line">    socket_fd = INVALID_SOCKET;</div>
<div class="line">    WSADATA wsaData;</div>
<div class="line">    WSAStartup(MAKEWORD(2, 2), &amp;wsaData);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">    socket_fd = -1;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">DeskflowClient::~DeskflowClient() {</div>
<div class="line">    disconnect();</div>
<div class="line"><span class="preprocessor">#ifdef _WIN32</span></div>
<div class="line">    WSACleanup();</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">bool</span> DeskflowClient::connect() {</div>
<div class="line">    socket_fd = socket(AF_INET, SOCK_STREAM, 0);</div>
<div class="line"><span class="preprocessor">#ifdef _WIN32</span></div>
<div class="line">    <span class="keywordflow">if</span> (socket_fd == INVALID_SOCKET) {</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">    <span class="keywordflow">if</span> (socket_fd &lt; 0) {</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;Socket creation failed&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">struct </span>sockaddr_in server_addr;</div>
<div class="line">    server_addr.sin_family = AF_INET;</div>
<div class="line">    server_addr.sin_port = htons(server_port);</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> (inet_pton(AF_INET, server_ip.c_str(), &amp;server_addr.sin_addr) &lt;= 0) {</div>
<div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;Invalid address&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line"><span class="preprocessor">#ifdef _WIN32</span></div>
<div class="line">    <span class="keywordflow">if</span> (::connect(socket_fd, (<span class="keyword">struct</span> sockaddr*)&amp;server_addr, <span class="keyword">sizeof</span>(server_addr)) == SOCKET_ERROR) {</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">    <span class="keywordflow">if</span> (::connect(socket_fd, (<span class="keyword">struct</span> sockaddr*)&amp;server_addr, <span class="keyword">sizeof</span>(server_addr)) &lt; 0) {</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;Connection failed&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Connected to Deskflow server at &quot;</span> &lt;&lt; server_ip &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; server_port &lt;&lt; std::endl;</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><p>*Reference: protocol_handshake for connection establishment*</p>
<h1><a class="anchor" id="autotoc_md13"></a>
Step 3: Protocol Handshake Implementation</h1>
<p>Implement the handshake sequence required by the Deskflow protocol:</p>
<div class="fragment"><div class="line"><span class="comment">// client.cpp (continued)</span></div>
<div class="line"><span class="keywordtype">bool</span> DeskflowClient::performHandshake() {</div>
<div class="line">    <span class="comment">// Step 1: Receive Hello message from server</span></div>
<div class="line">    <span class="keywordtype">char</span> hello_buffer[256];</div>
<div class="line"><span class="preprocessor">#ifdef _WIN32</span></div>
<div class="line">    <span class="keywordtype">int</span> bytes_received = recv(socket_fd, hello_buffer, <span class="keyword">sizeof</span>(hello_buffer), 0);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">    ssize_t bytes_received = recv(socket_fd, hello_buffer, <span class="keyword">sizeof</span>(hello_buffer), 0);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> (bytes_received &lt;= 0) {</div>
<div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;Failed to receive Hello message&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Verify Hello message format: &quot;Deskflow&quot; + version bytes</span></div>
<div class="line">    <span class="keywordflow">if</span> (strncmp(hello_buffer, <a class="code hl_variable" href="ProtocolTypes_8cpp.html#a7fe883657ad6c4ac7077705202493ff6">kMsgHello</a>, strlen(<a class="code hl_variable" href="ProtocolTypes_8cpp.html#a7fe883657ad6c4ac7077705202493ff6">kMsgHello</a>)) != 0) {</div>
<div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;Invalid Hello message received&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Extract protocol version (bytes after &quot;Deskflow&quot;)</span></div>
<div class="line">    uint16_t major_version = ntohs(*(uint16_t*)(hello_buffer + strlen(<a class="code hl_variable" href="ProtocolTypes_8cpp.html#a7fe883657ad6c4ac7077705202493ff6">kMsgHello</a>)));</div>
<div class="line">    uint16_t minor_version = ntohs(*(uint16_t*)(hello_buffer + strlen(<a class="code hl_variable" href="ProtocolTypes_8cpp.html#a7fe883657ad6c4ac7077705202493ff6">kMsgHello</a>) + 2));</div>
<div class="line">    </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Server protocol version: &quot;</span> &lt;&lt; major_version &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; minor_version &lt;&lt; std::endl;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Step 2: Send HelloBack message</span></div>
<div class="line">    std::string client_name = <span class="stringliteral">&quot;MinimalClient&quot;</span>;</div>
<div class="line">    std::vector&lt;char&gt; hello_back_buffer;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Add HelloBack identifier</span></div>
<div class="line">    hello_back_buffer.insert(hello_back_buffer.end(), <a class="code hl_variable" href="ProtocolTypes_8cpp.html#afc643c9a9e9f9daf5082657a4faf6575">kMsgHelloBack</a>, <a class="code hl_variable" href="ProtocolTypes_8cpp.html#afc643c9a9e9f9daf5082657a4faf6575">kMsgHelloBack</a> + strlen(<a class="code hl_variable" href="ProtocolTypes_8cpp.html#afc643c9a9e9f9daf5082657a4faf6575">kMsgHelloBack</a>));</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Add our protocol version (1.8)</span></div>
<div class="line">    uint16_t our_major = htons(1);</div>
<div class="line">    uint16_t our_minor = htons(8);</div>
<div class="line">    hello_back_buffer.insert(hello_back_buffer.end(), (<span class="keywordtype">char</span>*)&amp;our_major, (<span class="keywordtype">char</span>*)&amp;our_major + 2);</div>
<div class="line">    hello_back_buffer.insert(hello_back_buffer.end(), (<span class="keywordtype">char</span>*)&amp;our_minor, (<span class="keywordtype">char</span>*)&amp;our_minor + 2);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Add client name length and name</span></div>
<div class="line">    uint32_t name_length = htonl((uint32_t)client_name.length());</div>
<div class="line">    hello_back_buffer.insert(hello_back_buffer.end(), (<span class="keywordtype">char</span>*)&amp;name_length, (<span class="keywordtype">char</span>*)&amp;name_length + 4);</div>
<div class="line">    hello_back_buffer.insert(hello_back_buffer.end(), client_name.begin(), client_name.end());</div>
<div class="line">    </div>
<div class="line"><span class="preprocessor">#ifdef _WIN32</span></div>
<div class="line">    <span class="keywordtype">int</span> bytes_sent = send(socket_fd, hello_back_buffer.data(), (<span class="keywordtype">int</span>)hello_back_buffer.size(), 0);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">    ssize_t bytes_sent = send(socket_fd, hello_back_buffer.data(), hello_back_buffer.size(), 0);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">    <span class="keywordflow">if</span> (bytes_sent != (<span class="keywordtype">int</span>)hello_back_buffer.size()) {</div>
<div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;Failed to send HelloBack message&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Handshake completed successfully&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><p>*Reference: protocol_handshake for handshake message format*</p>
<h1><a class="anchor" id="autotoc_md14"></a>
Step 4: Message Processing Loop</h1>
<p>Implement the main loop to receive and process protocol messages:</p>
<div class="fragment"><div class="line"><span class="comment">// client.cpp (continued)</span></div>
<div class="line"><span class="keywordtype">void</span> DeskflowClient::messageLoop() {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Entering message processing loop...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">char</span> message_buffer[1024];</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><span class="preprocessor">#ifdef _WIN32</span></div>
<div class="line">        <span class="keywordtype">int</span> bytes_received = recv(socket_fd, message_buffer, <span class="keyword">sizeof</span>(message_buffer), 0);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">        ssize_t bytes_received = recv(socket_fd, message_buffer, <span class="keyword">sizeof</span>(message_buffer), 0);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">if</span> (bytes_received &lt;= 0) {</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;Connection closed by server&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">if</span> (bytes_received &lt; 4) {</div>
<div class="line">            <span class="keywordflow">continue</span>; <span class="comment">// Need at least 4 bytes for message code</span></div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Extract 4-byte message code</span></div>
<div class="line">        std::string message_code(message_buffer, 4);</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">if</span> (message_code == <a class="code hl_variable" href="ProtocolTypes_8cpp.html#ae826571a53b798c573418568f4397190">kMsgCEnter</a>) {</div>
<div class="line">            handleEnterMessage(message_buffer + 4, bytes_received - 4);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (message_code == <a class="code hl_variable" href="ProtocolTypes_8cpp.html#a35d0d7f0915dec1e257361c62375c368">kMsgCLeave</a>) {</div>
<div class="line">            handleLeaveMessage();</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (message_code == <a class="code hl_variable" href="ProtocolTypes_8cpp.html#a3347d0669e9605acefc17c4f1ee07a7d">kMsgDKeyDown</a>) {</div>
<div class="line">            handleKeyDownMessage(message_buffer + 4, bytes_received - 4);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (message_code == <a class="code hl_variable" href="ProtocolTypes_8cpp.html#a913e15118bd280fffb9c8c32b09c66cc">kMsgDKeyUp</a>) {</div>
<div class="line">            handleKeyUpMessage(message_buffer + 4, bytes_received - 4);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (message_code == <a class="code hl_variable" href="ProtocolTypes_8cpp.html#abdaf456469bf555b61c284c1587f35cd">kMsgDMouseMove</a>) {</div>
<div class="line">            handleMouseMoveMessage(message_buffer + 4, bytes_received - 4);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (message_code == <a class="code hl_variable" href="ProtocolTypes_8cpp.html#aff32db0e9923aae3eba184bde7aecb87">kMsgDMouseDown</a>) {</div>
<div class="line">            handleMouseDownMessage(message_buffer + 4, bytes_received - 4);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (message_code == <a class="code hl_variable" href="ProtocolTypes_8cpp.html#aae6fdcf9a64d2cb4adce0d5e5e7b63cb">kMsgDMouseUp</a>) {</div>
<div class="line">            handleMouseUpMessage(message_buffer + 4, bytes_received - 4);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> {</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;Unknown message: &quot;</span> &lt;&lt; message_code &lt;&lt; std::endl;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>*Reference: protocol_commands and protocol_data for message types*</p>
<h1><a class="anchor" id="autotoc_md15"></a>
Step 5: Input Event Handlers</h1>
<p>Implement handlers for specific input events:</p>
<div class="fragment"><div class="line"><span class="comment">// client.cpp (continued)</span></div>
<div class="line"><span class="keywordtype">void</span> handleEnterMessage(<span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code hl_variable" href="ArchNetworkWinsock_8cpp.html#aa36d05423b2dd8f3c8296093b4674b63">data</a>, <span class="keywordtype">size_t</span> length) {</div>
<div class="line">    <span class="keywordflow">if</span> (length &lt; 8) <span class="keywordflow">return</span>;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Extract mouse position (2 bytes x, 2 bytes y)</span></div>
<div class="line">    int16_t <a class="code hl_variable" href="ServerConfig_8cpp.html#a6150e0515f7202e2fb518f7206ed97dc">x</a> = ntohs(*(int16_t*)<a class="code hl_variable" href="ArchNetworkWinsock_8cpp.html#aa36d05423b2dd8f3c8296093b4674b63">data</a>);</div>
<div class="line">    int16_t <a class="code hl_variable" href="ServerConfig_8cpp.html#a0a2f84ed7838f07779ae24c5a9086d33">y</a> = ntohs(*(int16_t*)(<a class="code hl_variable" href="ArchNetworkWinsock_8cpp.html#aa36d05423b2dd8f3c8296093b4674b63">data</a> + 2));</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Extract modifier mask (4 bytes)</span></div>
<div class="line">    uint32_t modifiers = ntohl(*(uint32_t*)(<a class="code hl_variable" href="ArchNetworkWinsock_8cpp.html#aa36d05423b2dd8f3c8296093b4674b63">data</a> + 4));</div>
<div class="line">    </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Mouse entered screen at (&quot;</span> &lt;&lt; <a class="code hl_variable" href="ServerConfig_8cpp.html#a6150e0515f7202e2fb518f7206ed97dc">x</a> &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; <a class="code hl_variable" href="ServerConfig_8cpp.html#a0a2f84ed7838f07779ae24c5a9086d33">y</a> &lt;&lt; <span class="stringliteral">&quot;) with modifiers: &quot;</span> &lt;&lt; modifiers &lt;&lt; std::endl;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Here you would set the actual mouse cursor position on your system</span></div>
<div class="line">    <span class="comment">// Platform-specific code needed (X11, Windows API, etc.)</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> handleLeaveMessage() {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Mouse left screen&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    <span class="comment">// Cleanup any active input state</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> handleKeyDownMessage(<span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code hl_variable" href="ArchNetworkWinsock_8cpp.html#aa36d05423b2dd8f3c8296093b4674b63">data</a>, <span class="keywordtype">size_t</span> length) {</div>
<div class="line">    <span class="keywordflow">if</span> (length &lt; 6) <span class="keywordflow">return</span>;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Extract key ID (2 bytes) and modifiers (2 bytes)</span></div>
<div class="line">    uint16_t key_id = ntohs(*(uint16_t*)<a class="code hl_variable" href="ArchNetworkWinsock_8cpp.html#aa36d05423b2dd8f3c8296093b4674b63">data</a>);</div>
<div class="line">    uint16_t modifiers = ntohs(*(uint16_t*)(<a class="code hl_variable" href="ArchNetworkWinsock_8cpp.html#aa36d05423b2dd8f3c8296093b4674b63">data</a> + 2));</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Extract key code (2 bytes) - available in protocol 1.1+</span></div>
<div class="line">    uint16_t key_code = ntohs(*(uint16_t*)(<a class="code hl_variable" href="ArchNetworkWinsock_8cpp.html#aa36d05423b2dd8f3c8296093b4674b63">data</a> + 4));</div>
<div class="line">    </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Key pressed: ID=&quot;</span> &lt;&lt; key_id &lt;&lt; <span class="stringliteral">&quot;, Code=&quot;</span> &lt;&lt; key_code &lt;&lt; <span class="stringliteral">&quot;, Modifiers=&quot;</span> &lt;&lt; modifiers &lt;&lt; std::endl;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Here you would synthesize the key press on your system</span></div>
<div class="line">    <span class="comment">// Platform-specific code needed</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> handleMouseMoveMessage(<span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code hl_variable" href="ArchNetworkWinsock_8cpp.html#aa36d05423b2dd8f3c8296093b4674b63">data</a>, <span class="keywordtype">size_t</span> length) {</div>
<div class="line">    <span class="keywordflow">if</span> (length &lt; 4) <span class="keywordflow">return</span>;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Extract absolute mouse position</span></div>
<div class="line">    int16_t <a class="code hl_variable" href="ServerConfig_8cpp.html#a6150e0515f7202e2fb518f7206ed97dc">x</a> = ntohs(*(int16_t*)<a class="code hl_variable" href="ArchNetworkWinsock_8cpp.html#aa36d05423b2dd8f3c8296093b4674b63">data</a>);</div>
<div class="line">    int16_t <a class="code hl_variable" href="ServerConfig_8cpp.html#a0a2f84ed7838f07779ae24c5a9086d33">y</a> = ntohs(*(int16_t*)(<a class="code hl_variable" href="ArchNetworkWinsock_8cpp.html#aa36d05423b2dd8f3c8296093b4674b63">data</a> + 2));</div>
<div class="line">    </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Mouse moved to (&quot;</span> &lt;&lt; <a class="code hl_variable" href="ServerConfig_8cpp.html#a6150e0515f7202e2fb518f7206ed97dc">x</a> &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; <a class="code hl_variable" href="ServerConfig_8cpp.html#a0a2f84ed7838f07779ae24c5a9086d33">y</a> &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Here you would move the actual mouse cursor</span></div>
<div class="line">    <span class="comment">// Platform-specific code needed</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> handleKeyUpMessage(<span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code hl_variable" href="ArchNetworkWinsock_8cpp.html#aa36d05423b2dd8f3c8296093b4674b63">data</a>, <span class="keywordtype">size_t</span> length) {</div>
<div class="line">    <span class="keywordflow">if</span> (length &lt; 6) <span class="keywordflow">return</span>;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Extract key ID (2 bytes) and modifiers (2 bytes)</span></div>
<div class="line">    uint16_t key_id = ntohs(*(uint16_t*)<a class="code hl_variable" href="ArchNetworkWinsock_8cpp.html#aa36d05423b2dd8f3c8296093b4674b63">data</a>);</div>
<div class="line">    uint16_t modifiers = ntohs(*(uint16_t*)(<a class="code hl_variable" href="ArchNetworkWinsock_8cpp.html#aa36d05423b2dd8f3c8296093b4674b63">data</a> + 2));</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Extract key code (2 bytes) - available in protocol 1.1+</span></div>
<div class="line">    uint16_t key_code = ntohs(*(uint16_t*)(<a class="code hl_variable" href="ArchNetworkWinsock_8cpp.html#aa36d05423b2dd8f3c8296093b4674b63">data</a> + 4));</div>
<div class="line">    </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Key released: ID=&quot;</span> &lt;&lt; key_id &lt;&lt; <span class="stringliteral">&quot;, Code=&quot;</span> &lt;&lt; key_code &lt;&lt; <span class="stringliteral">&quot;, Modifiers=&quot;</span> &lt;&lt; modifiers &lt;&lt; std::endl;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Here you would synthesize the key release on your system</span></div>
<div class="line">    <span class="comment">// Platform-specific code needed</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> handleMouseDownMessage(<span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code hl_variable" href="ArchNetworkWinsock_8cpp.html#aa36d05423b2dd8f3c8296093b4674b63">data</a>, <span class="keywordtype">size_t</span> length) {</div>
<div class="line">    <span class="keywordflow">if</span> (length &lt; 1) <span class="keywordflow">return</span>;</div>
<div class="line">    </div>
<div class="line">    uint8_t button_id = <a class="code hl_variable" href="ArchNetworkWinsock_8cpp.html#aa36d05423b2dd8f3c8296093b4674b63">data</a>[0];</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Mouse button &quot;</span> &lt;&lt; (int)button_id &lt;&lt; <span class="stringliteral">&quot; pressed&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Here you would synthesize the mouse button press</span></div>
<div class="line">    <span class="comment">// Platform-specific code needed</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> handleMouseUpMessage(<span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code hl_variable" href="ArchNetworkWinsock_8cpp.html#aa36d05423b2dd8f3c8296093b4674b63">data</a>, <span class="keywordtype">size_t</span> length) {</div>
<div class="line">    <span class="keywordflow">if</span> (length &lt; 1) <span class="keywordflow">return</span>;</div>
<div class="line">    </div>
<div class="line">    uint8_t button_id = <a class="code hl_variable" href="ArchNetworkWinsock_8cpp.html#aa36d05423b2dd8f3c8296093b4674b63">data</a>[0];</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Mouse button &quot;</span> &lt;&lt; (int)button_id &lt;&lt; <span class="stringliteral">&quot; released&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Here you would synthesize the mouse button release</span></div>
<div class="line">    <span class="comment">// Platform-specific code needed</span></div>
<div class="line">}</div>
<div class="ttc" id="aServerConfig_8cpp_html_a0a2f84ed7838f07779ae24c5a9086d33"><div class="ttname"><a href="ServerConfig_8cpp.html#a0a2f84ed7838f07779ae24c5a9086d33">y</a></div><div class="ttdeci">int y</div><div class="ttdef"><b>Definition</b> ServerConfig.cpp:27</div></div>
<div class="ttc" id="aServerConfig_8cpp_html_a6150e0515f7202e2fb518f7206ed97dc"><div class="ttname"><a href="ServerConfig_8cpp.html#a6150e0515f7202e2fb518f7206ed97dc">x</a></div><div class="ttdeci">int x</div><div class="ttdef"><b>Definition</b> ServerConfig.cpp:26</div></div>
</div><!-- fragment --><p>*Reference: protocol_data for message parameter formats*</p>
<h1><a class="anchor" id="autotoc_md16"></a>
Step 6: Complete Working Client</h1>
<p>Put it all together in the main function:</p>
<div class="fragment"><div class="line"><span class="comment">// main.cpp</span></div>
<div class="line"><span class="preprocessor">#include &quot;client.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="deskflow-client_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>() {</div>
<div class="line">    <span class="keyword">const</span> std::string server_ip = <span class="stringliteral">&quot;127.0.0.1&quot;</span>; <span class="comment">// localhost for testing</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> server_port = 24800; <span class="comment">// Default Deskflow port</span></div>
<div class="line">    </div>
<div class="line">    DeskflowClient client(server_ip, server_port);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Connect to server</span></div>
<div class="line">    <span class="keywordflow">if</span> (!client.connect()) {</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Perform protocol handshake</span></div>
<div class="line">    <span class="keywordflow">if</span> (!client.performHandshake()) {</div>
<div class="line">        client.disconnect();</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Start processing messages</span></div>
<div class="line">    client.messageLoop();</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Cleanup</span></div>
<div class="line">    client.disconnect();</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="adeskflow-client_8cpp_html_a3c04138a5bfe5d72780bb7e82a18e627"><div class="ttname"><a href="deskflow-client_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a></div><div class="ttdeci">int main(int argc, char **argv)</div><div class="ttdef"><b>Definition</b> deskflow-client.cpp:19</div></div>
</div><!-- fragment --><p>And the disconnect method in client.cpp:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> DeskflowClient::disconnect() {</div>
<div class="line"><span class="preprocessor">#ifdef _WIN32</span></div>
<div class="line">    <span class="keywordflow">if</span> (socket_fd != INVALID_SOCKET) {</div>
<div class="line">        closesocket(socket_fd);</div>
<div class="line">        socket_fd = INVALID_SOCKET;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">    <span class="keywordflow">if</span> (socket_fd &gt;= 0) {</div>
<div class="line">        close(socket_fd);</div>
<div class="line">        socket_fd = -1;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;Disconnected from server&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md17"></a>
Compilation and Testing</h1>
<h2><a class="anchor" id="autotoc_md18"></a>
Using CMake (Recommended)</h2>
<p>Build the client using CMake:</p>
<div class="fragment"><div class="line"># Generate build files</div>
<div class="line">cmake .</div>
<div class="line"> </div>
<div class="line"># Build the project</div>
<div class="line">cmake --build .</div>
</div><!-- fragment --><p>On Windows, this will create <code>Debug/deskflow_client.exe</code>. On Linux/macOS, this will create <code>deskflow_client</code>.</p>
<h2><a class="anchor" id="autotoc_md19"></a>
Manual Compilation (Alternative)</h2>
<p>On Linux/macOS: </p><div class="fragment"><div class="line">g++ -o deskflow_client main.cpp client.cpp -std=c++17</div>
</div><!-- fragment --><p>On Windows with MSVC: </p><div class="fragment"><div class="line">cl main.cpp client.cpp /std:c++17 /Fe:deskflow_client.exe ws2_32.lib</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md20"></a>
Testing</h2>
<p>Run the client (ensure Deskflow server is running):</p>
<p>Windows: </p><div class="fragment"><div class="line">./Debug/deskflow_client.exe</div>
</div><!-- fragment --><p>Linux/macOS: </p><div class="fragment"><div class="line">./deskflow_client</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md21"></a>
Working Client Result</h1>
<p>This implementation creates a functional Deskflow client that:</p>
<ol type="1">
<li>Connects to a Deskflow server via TCP</li>
<li>Performs the required protocol handshake</li>
<li>Receives and processes input events (keyboard, mouse)</li>
<li>Displays event information (ready for platform-specific input synthesis)</li>
</ol>
<p>The client compiles successfully on Windows with Visual Studio and should work on Linux/macOS with GCC. When no server is running, it will display "Connection failed" and exit gracefully.</p>
<p>To make it fully functional, add platform-specific code to actually synthesize the input events on your system using APIs like X11 (Linux), Windows API (Windows), or Core Graphics (macOS).</p>
<p>*Complete protocol reference: <a class="el" href="ProtocolTypes_8h.html">ProtocolTypes.h</a>* *Message utilities: <a class="el" href="ProtocolUtil_8h.html">ProtocolUtil.h</a>* *Full protocol documentation: <a class="el" href="md_doc_2dev_2protocol.html">Protocol Overview</a>* </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
